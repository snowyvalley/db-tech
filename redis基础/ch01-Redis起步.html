<!doctype html>
<html class='blink-to-pdf' >
<head>
<meta charset='UTF-8'><meta name='viewport' content='width=device-width initial-scale=1'>
<title>ch01-Redis起步.md</title><link rel='stylesheet' href='file:///C:/Program%20Files/Typora/resources/app//lib.asar/diagram/css/mermaid.css' type='text/css' /><link rel='stylesheet' href='file:///C:/Program%20Files/Typora/resources/app//style/codemirror.css' type='text/css' /><link rel='stylesheet' href='file:///C:/Program%20Files/Typora/resources/app//style/base.css' type='text/css' /><link rel='stylesheet' href='file:///C:\\Users\\jerry\\AppData\\Roaming\\Typora\\themes\\newsprint.css' type='text/css' />
<link rel='stylesheet' href='file:///C:\\Users\\jerry\\AppData\\Roaming\\Typora\\themes\\base.user.css' type='text/css' />
<link rel='stylesheet' href='file:///C:\\Users\\jerry\\AppData\\Roaming\\Typora\\themes\\newsprint.user.css' type='text/css' /><style type='text/css'>html {overflow-x: initial !important;}
</style>
</head>
<body class='typora-export' >
<div  id='write' style='top:auto' class = 'is-node'><h1><a name='header-n0' class='md-header-anchor md-print-anchor' href='af://n0'> </a>ch01 Redis起步</h1><h2><a name='header-n2' class='md-header-anchor md-print-anchor' href='af://n2'> </a>Redis概述</h2><ul><li><p>Redis代表：<strong>RE</strong> mote  <strong>DI</strong> ctionary   <strong>S</strong> erver</p></li><li><p>Redis是NoSQL（not only sql），基于键值的数据存储。</p></li><li><p>具有强大的数据类型，包括：Strings, Hashes,Lists, Sets, Sorted Sets, Bitmaps, and HyperLogLogs</p></li><li><p>默认情况下，Redis将所有数据存储到内存中</p></li><li><p>开源网址: <a href='https://github.com/antirez/redis'>https://github.com/antirez/redis</a></p></li><li><p>文档地址：<a href='http://redis.io'>http://redis.io</a></p><p>​</p></li></ul><h2><a name='header-n24' class='md-header-anchor md-print-anchor' href='af://n24'> </a>Redis 安装</h2><h3><a name='header-n25' class='md-header-anchor md-print-anchor' href='af://n25'> </a>redis支持的平台</h3><ul><li>Linux</li><li>OS X</li><li>OpenBSD</li><li>NetBSD</li><li>FreeBSD</li></ul><p><em>Redis并不官方支持windows，但是对windows平台的支持可以查看链接:<a href='https://github.com/MicrosoftArchive/redis/releases'>https://github.com/MicrosoftArchive/redis/releases</a></em></p><h3><a name='header-n44' class='md-header-anchor md-print-anchor' href='af://n44'> </a>Windows版本安装</h3><p>下载地址：<a href='https://github.com/MicrosoftArchive/redis/releases'>https://github.com/MicrosoftArchive/redis/releases</a></p><p>可下载文件：Redis-x64-3.0.504.msi或者Redis-x64-3.0.504.zip</p><p><strong>注意： 仅支持64位windows</strong></p><h4><a name='header-n51' class='md-header-anchor md-print-anchor' href='af://n51'> </a>安装与启动</h4><ol start='' ><li><p>解压zip文件，并将文件夹内容拷贝到待安装位置</p></li><li><p>通过命令行进入安装位置，运行命令启动redis服务</p><p>C:\develop_tools\redis&gt;redis-server</p><p><strong>注意：这里没有指定配置文件，将采取默认配置启动服务</strong></p><p> 服务启动后输出信息：</p><p><img src='file://D:/github/snowyvalley/mytrain/db-tech/redis%E5%9F%BA%E7%A1%80/ch01-resource/images/ch01-1.png' alt='服务启动截图' /></p><p>​</p><p><em>说明：</em></p><p><em>这里将输出程序启动的进程id，即pid:4500，以及客户端连接需要使用的端口，这里是port:6379</em></p><h2><a name='header-n73' class='md-header-anchor md-print-anchor' href='af://n73'> </a>连接到redis服务</h2><h3><a name='header-n74' class='md-header-anchor md-print-anchor' href='af://n74'> </a>使用redis客户端命令行接口连接redis服务</h3><p>C:\develop_tools\redis&gt;redis-cli</p><p>127.0.0.1:6379&gt; set student_name &#39;jerry&#39;
OK
127.0.0.1:6379&gt; get student_name
&quot;jerry&quot;
127.0.0.1:6379&gt;</p><p><strong>说明：</strong></p><ul><li>redis-cli，该命令启动redis客户端命令行接口</li><li>set存储一个键值信息</li><li>get根据key取值</li></ul><h3><a name='header-n95' class='md-header-anchor md-print-anchor' href='af://n95'> </a>获取帮助-使用help命令</h3><p>127.0.0.1:6379&gt; help set</p><p>  SET key value [EX seconds][PX milliseconds] [NX|XX]
  summary: Set the string value of a key
  since: 1.0.0
  group: string</p><p>127.0.0.1:6379&gt;</p><h3><a name='header-n105' class='md-header-anchor md-print-anchor' href='af://n105'> </a>根据匹配模式查找key</h3><p>127.0.0.1:6379&gt; keys u*
(empty list or set)
127.0.0.1:6379&gt; keys stu*
1) &quot;student_name&quot;
127.0.0.1:6379&gt;</p></li></ol><p><strong>注意：redis-cli仅用于调试目的，实践中使用JavaScript脚本和node.js</strong></p><h2><a name='header-n114' class='md-header-anchor md-print-anchor' href='af://n114'> </a>node.js安装</h2><p>node.js下载地址：<a href='https://nodejs.org'>https://nodejs.org</a></p><p>可运行平台：Mac OS X, Windows, Linux</p><p>当前版本：v8.9.3</p><h3><a name='header-n121' class='md-header-anchor md-print-anchor' href='af://n121'> </a>安装步骤</h3><ol start='' ><li><p>双击安装，默认安装位置：C:\Program Files\nodejs\</p></li><li><p>建立项目开发文件夹: D:\redisdemo\ch01</p></li><li><p>进入项目开发文件夹运行npm命令，安装redis库（或称redis模块）</p><p>D:\redisdemo\ch01&gt;npm install redis</p></li><li><p>安装完成后在ch01\node_modules下会产生redis的相关文件夹，这里就是redis的客户端安装位置</p><p><strong>注意：不要在nodejs安装文件夹下运行npm install redis，这样会删除npm包，可以运行npm install redis -g 安装为全局方式。</strong></p><p>​</p></li></ol><h2><a name='header-n141' class='md-header-anchor md-print-anchor' href='af://n141'> </a>使用node.js操作redis</h2><h3><a name='header-n142' class='md-header-anchor md-print-anchor' href='af://n142'> </a>编写代码</h3><p>在nodejs安装目录下建立hello.js并输入如下代码：</p><p>var redis = require(&quot;redis&quot;); // 1
var client = redis.createClient(); // 2
client.set(&quot;my_key&quot;, &quot;Hello World using Node.js and Redis&quot;); // 3
client.get(&quot;my_key&quot;, redis.print); // 4
client.quit(); // 5</p><p>代码说明：</p><p>line1：表示node.js需要redis库</p><p>line2：建立redis客户端对象</p><p>line3：执行redis的set命令将一个字符串存储在my_key中</p><p>line4：执行redis的get命令取出my_key中的值并打印</p><p>line5：关闭到redis的服务端连接</p><h3><a name='header-n163' class='md-header-anchor md-print-anchor' href='af://n163'> </a>运行代码：</h3><p>在项目文件夹下运行命令行：</p><p>D:\redisdemo\ch01&gt;node hello.js
Reply: Hello World using Node.js and Redis</p><hr /><h2><a name='header-n170' class='md-header-anchor md-print-anchor' href='af://n170'> </a>使用webstorm开发node.js</h2><p>参考内容：<a href='ch01-ref-%E4%BD%BF%E7%94%A8webstorm%E7%BC%96%E5%86%99node.js%E6%93%8D%E4%BD%9Credis.md'>ch01-ref-使用webstorm编写node.js操作redis.md</a></p><h2><a name='header-n173' class='md-header-anchor md-print-anchor' href='af://n173'> </a>redis 数据类型</h2><h3><a name='header-n174' class='md-header-anchor md-print-anchor' href='af://n174'> </a>String</h3><p>可以用于存储任何类型的数据：</p><ul><li>文本（xml，json，html，或者原始文本）</li><li>整数</li><li>浮点数</li><li>二进制数（视频，图片，音频）</li></ul><p><strong>注意：String类型的数据不能超过512M</strong></p><p>String类型可以用于以下场合：</p><ul><li>缓存机制：将文本或者二进制数据缓冲到redis中。这些数据来自html页面上的任何内容以及通过接口调用得到的图片，视频等。</li><li>缓存自动过期：对于操作数据库时，查询时间较长，或者频繁的查询，为了提高性能将使用缓存机制，当长时间不再访问这些数据时，又需要这些缓存自动过期。</li></ul><h3><a name='header-n201' class='md-header-anchor md-print-anchor' href='af://n201'> </a>通过redis-cli使用String的例子</h3><p>  相关命令：</p><p>  <strong>MSET</strong>：</p><p>  一次设置多个key和值，key-value对用空格隔开</p><p>  <strong>MGET</strong>：</p><p>  一次返回多个key名对应的值，key名用空格隔开</p><p>  <em>代码示例</em></p><p>  C:\develop_tools\redis&gt;redis-cli
  127.0.0.1:6379&gt; mset student1 &quot;jerry&quot; student2 &quot;petter&quot;
  OK
  127.0.0.1:6379&gt; mget student1 student2
  1) &quot;jerry&quot;
  2) &quot;petter&quot;
  127.0.0.1:6379&gt;</p><p><strong>EXPIRE</strong></p><p>为给定的key添加一个过期时间（单位为秒），过期后自动删除给key，返回1表示设置成功，返回0表示该key不存在或者无法设置</p><p><strong>TTL</strong>(time to live)</p><ul><li>返回正数，表示给定key存活了多少秒</li><li>-2 该key已经过期或者不存在</li><li>-1 该key存在，但没有设置过期时间</li></ul><p><em>代码示例</em></p><p>127.0.0.1:6379&gt; set course &quot;Redis Basic&quot;
OK
127.0.0.1:6379&gt; expire course 10
(integer) 1
127.0.0.1:6379&gt; get course
&quot;Redis Basic&quot;
127.0.0.1:6379&gt; ttl course
(integer) -2
127.0.0.1:6379&gt; get course
(nil)
127.0.0.1:6379&gt;</p><p><strong>INCR</strong></p><p>将指定key的值加1后，返回该值</p><p><strong>INCRBY</strong></p><p>将指定key加上给定整数后，并返回该值</p><p><strong>DECR、DECRBY</strong></p><p>和INCR,INCRBY刚好相反，只是减小值</p><p><strong>INCRBYFLOAT</strong></p><p>加上一个浮点数并返回</p><p><strong>注意：INCRBY,DECRBY,INCRBYFLOAT均可接收正数和负数</strong></p><p><em>代码示例</em></p><p>C:\develop_tools\redis&gt;redis-cli
127.0.0.1:6379&gt; set counter 100
OK
127.0.0.1:6379&gt; incr counter
(integer) 101
127.0.0.1:6379&gt; incrby counter 5
(integer) 106
127.0.0.1:6379&gt; decr counter
(integer) 105
127.0.0.1:6379&gt; decrby counter 50
(integer) 55
127.0.0.1:6379&gt; incrbyfloat counter 5.5
&quot;60.5&quot;
127.0.0.1:6379&gt; get counter
&quot;60.5&quot;
127.0.0.1:6379&gt;</p><p><strong>注意：</strong></p><p><em>Redis是单线程的，这就意味着每一时刻只会有一个客户端执行命令，不会存在多个客户端同时访问相同key的问题。</em></p><h3><a name='header-n293' class='md-header-anchor md-print-anchor' href='af://n293'> </a>使用Node.js建立投票系统</h3><p><strong>需求</strong></p><ol start='' ><li>建立一个文章列表</li><li>使用node.js为列表中的文章进行投票，票数加1</li><li>减小一个文章的票数，票数减1</li><li>显示文章及票数</li></ol><p><strong>实现思路</strong></p><ul><li>将文章列表存储到redis中</li><li>编写3个函数，upVote,downVote,showResults均将文章ID作为参数</li><li>文章key的命名规则    article:<id>:java</li><li>投票key的命名规则    article:<id>:votes</li></ul><p><strong>实现步骤</strong></p><p><em>step1：建立文章列表（假设有三篇文章）</em></p><p>127.0.0.1:6379&gt; set article:1001:java &quot;what is JVM&quot;
OK
127.0.0.1:6379&gt; set article:1002:java &quot;Java basic for beginer&quot;
OK
127.0.0.1:6379&gt; set article:1003:java &quot;about the Runtime exception&quot;
OK
127.0.0.1:6379&gt;</p><p><em>step2：编写投票的代码</em></p><p>文件名：aritcles-popularity.js</p><pre class="md-fences md-end-block" lang=""> <div class="CodeMirror cm-s-inner CodeMirror-wrap"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 4px;"></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 30px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">var redis = require("redis");</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">var client = redis.createClient();</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">function upVote(id) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  var key = "article:"+id+":votes";</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  client.incr(key);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre></div></div></div></div></div><div style="position: absolute; height: 30px; width: 1px; border-bottom: 0px solid transparent; top: 144px;"></div><div class="CodeMirror-gutters" style="display: none; height: 174px;"></div></div></div></pre><p><em>step3：编写减小投票数的代码</em></p><pre class="md-fences md-end-block" lang=""> <div class="CodeMirror cm-s-inner CodeMirror-wrap"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 4px;"></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 30px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">function downVote(id) {</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  var key = "article:"+id+":votes";</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  client.decr(key);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre></div></div></div></div></div><div style="position: absolute; height: 30px; width: 1px; border-bottom: 0px solid transparent; top: 96px;"></div><div class="CodeMirror-gutters" style="display: none; height: 126px;"></div></div></div></pre><p><em>step4：编写显示文章和投票数的代码</em></p><pre class="md-fences md-end-block" lang=""> <div class="CodeMirror cm-s-inner CodeMirror-wrap"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 4px;"></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 30px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">function showResults(id) {</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  var articleKey = "article:"+id+":java";</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  var voteKey = "article:"+id+":votes";</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  client.mget([articleKey,voteKey],function (err,replies) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  console.log('The article- '+replies[0]+'] has',replies[1],'votes');</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  });</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre></div></div></div></div></div><div style="position: absolute; height: 30px; width: 1px; border-bottom: 0px solid transparent; top: 192px;"></div><div class="CodeMirror-gutters" style="display: none; height: 222px;"></div></div></div></pre><p>【代码说明】</p><ol start='' ><li><p>为MGET命令传递一个key数组和一个回调函数。如果key不存在或者没有值将返回null</p></li><li><p>在匿名函数中，参数replies是数组，索引0处放的是articleKey的值即文章标题，而索引1处放的是voteKey的值即票数</p></li><li><p>console.log的用法：</p><p>console.log(object[, object, ...])
使用频率最高的一条语句：向控制台输出一条消息。
支持 C 语言 printf 式的格式化输出。当然，也可以不使用格式化输出来达到同样的目的：
var animal=&#39;frog&#39;, count=10;
console.log(&quot;The %s jumped over %d tall buildings&quot;, animal, count);
console.log(&quot;The&quot;, animal, &quot;jumped over&quot;, count, &quot;tall buildings&quot;);</p></li></ol><p><em>step5:投票测试代码</em> </p><pre class="md-fences md-end-block" lang=""> <div class="CodeMirror cm-s-inner CodeMirror-wrap"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 4px;"></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 30px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">upVote(1001);</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">upVote(1002);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">upVote(1003);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">upVote(1001);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">upVote(1001);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">upVote(1003);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">downVote(1001);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">showResults(1001);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">showResults(1002);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">showResults(1003);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">client.quit();</span></pre></div></div></div></div></div><div style="position: absolute; height: 30px; width: 1px; border-bottom: 0px solid transparent; top: 264px;"></div><div class="CodeMirror-gutters" style="display: none; height: 294px;"></div></div></div></pre><p><em>step6:运行结果</em></p><p>The article[ what is JVM] has 2 votes
The article[ Java basic for beginer] has 1 votes
The article[ about the Runtime exception] has 2 votes</p><hr /><h3><a name='header-n376' class='md-header-anchor md-print-anchor' href='af://n376'> </a>List</h3><ul><li>List类型在Redis中非常灵活，可以扮演简单集合，栈或者队列。</li><li>List命令是原子性的。</li><li>操作list的命令是阻塞式的，当一个客户端建立了一个空列表，其他客户端需要等待该客户端向其中添加一个新项目。</li><li>Redis中的list是Linked List</li></ul><p><strong>List应用场合</strong></p><ul><li>事件队列</li><li>存储用户最新帖子：比如Twitter</li></ul><h4><a name='header-n399' class='md-header-anchor md-print-anchor' href='af://n399'> </a>List示例</h4><p><em>LPUSH</em></p><p>向List的开头插入数据（left push）</p><p><em>RPUSH</em></p><p>向List结尾插入数据（right push)</p><p><em>LLEN</em></p><p>List长度（List length）</p><p><em>LINDEX</em></p><p>返回指定list在给定索引处的值，左侧（开头）第一个元素为索引为0，负值表示从右侧（末尾）访问，-1表示右侧第一个元素，-2右侧第二个元素</p><p>redis-cli练习：</p><p>C:\develop_tools\redis&gt;redis-cli
127.0.0.1:6379&gt; lpush books &quot;01:Java Basic&quot;
(integer) 1
127.0.0.1:6379&gt; lpush books &quot;02:Oracle advice&quot;
(integer) 2
127.0.0.1:6379&gt; rpush books &quot;03:redis basic&quot;
(integer) 3
127.0.0.1:6379&gt; llen books
(integer) 3
127.0.0.1:6379&gt; lindex books 1
&quot;01:Java Basic&quot;
127.0.0.1:6379&gt; lindex books 0
&quot;02:Oracle advice&quot;</p><p><em>LRANGE</em></p><p>返回给定索引范围内的元素构成的数组，索引值可正可负</p><p>redis-cli练习：</p><p>127.0.0.1:6379&gt; lrange books 0 1
1) &quot;02:Oracle advice&quot;
2) &quot;01:Java Basic&quot;
127.0.0.1:6379&gt; lrange books 0 -1
1) &quot;02:Oracle advice&quot;
2) &quot;01:Java Basic&quot;
3) &quot;03:redis basic&quot;</p><p><em>LPOP</em></p><p>移除并返回list第一个元素</p><p><em>RPOP</em></p><p>移除并返回list最后一个元素</p><p><strong>注意：Redis的list的不能从中间插入和删除数据</strong></p><p>redis-cli练习：</p><p>127.0.0.1:6379&gt; lpop books
&quot;02:Oracle advice&quot;
127.0.0.1:6379&gt; lrange books 0 -1
1) &quot;01:Java Basic&quot;
2) &quot;03:redis basic&quot;
127.0.0.1:6379&gt; rpop books
&quot;03:redis basic&quot;
127.0.0.1:6379&gt; lrange books 0 -1
1) &quot;01:Java Basic&quot;
127.0.0.1:6379&gt;</p><h4><a name='header-n469' class='md-header-anchor md-print-anchor' href='af://n469'> </a>实现一个通用队列系统</h4><p><em>step1：编写queue函数</em></p><p>建立queue.js，编写如下代码：</p><pre class="md-fences md-end-block" lang=""> <div class="CodeMirror cm-s-inner CodeMirror-wrap"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 4px;"></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 30px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">function Queue(queueName,redisClient) {//接收队列名和redis客户端对象作为参数</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  this.queueName = queueName;//将对列名保存到属性中</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  this.redisClient = redisClient;//保存redis客户端对象到属性中</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  this.queueKey = 'queues:'+queueName;//设置Redis key名</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  this.timeout = 0;//设置timeout属性为0，表示list命令执行后也不超时</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre></div></div></div></div></div><div style="position: absolute; height: 30px; width: 1px; border-bottom: 0px solid transparent; top: 168px;"></div><div class="CodeMirror-gutters" style="display: none; height: 198px;"></div></div></div></pre><p><em>step2:我们需要为队列建立三个方法：size，push，pop</em></p><p>实现size方法</p><pre class="md-fences md-end-block" lang=""> <div class="CodeMirror cm-s-inner CodeMirror-wrap"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 4px;"></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 30px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><span><span>​</span>x</span></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">Queue.prototype.size = function (callback) {//prototype返回Queue的原型引用，和其他编程语言</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">// 中类的解决方案类似，为Queue建立一个size方法，该方法接收callback作为参数</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  this.redisClient.llen(this.queueKey,callback);//由于Redis客户端是异步的，需要传递为llen函数callback作为参数</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre></div></div></div></div></div><div style="position: absolute; height: 30px; width: 1px; border-bottom: 0px solid transparent; top: 192px;"></div><div class="CodeMirror-gutters" style="display: none; height: 222px;"></div></div></div></pre><p>实现push方法</p><pre class="md-fences md-end-block" lang=""> <div class="CodeMirror cm-s-inner CodeMirror-wrap"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 4px;"></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 30px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">Queue.prototype.push = function (data) {//接收任何字符串</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  this.redisClient.lpush(this.queueKey,data);//加入到list的头部</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">};</span></pre></div></div></div></div></div><div style="position: absolute; height: 30px; width: 1px; border-bottom: 0px solid transparent; top: 72px;"></div><div class="CodeMirror-gutters" style="display: none; height: 102px;"></div></div></div></pre><p>【注意】</p><p>我们要实现的是队列，队列是先进先出FIFO（First In，First Out），因此我们需要在队列的前面插入数据，而从队列的尾部移除数据</p><p>实现pop方法</p><pre class="md-fences md-end-block" lang=""> <div class="CodeMirror cm-s-inner CodeMirror-wrap"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 4px;"></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 30px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">Queue.prototype.pop = function (callback) {//</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  this.redisClient.brpop(this.queueKey,this.timeout,callback);//从尾部移除数据</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">};</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">exports.Queue = Queue;//将queue.js开放给其他模块调用，其他模块可以使用require引入它。</span></pre></div></div></div></div></div><div style="position: absolute; height: 30px; width: 1px; border-bottom: 0px solid transparent; top: 168px;"></div><div class="CodeMirror-gutters" style="display: none; height: 198px;"></div></div></div></pre><p><em>说明</em></p><ul><li>这里是从尾部移除数据，如果前面push用的是rpush，那么这里就要使用blpop，队列是从一端加数据，从另一端移除数据</li><li>brpop是移除list中最后一个元素</li><li>brpop是rpop的阻塞式版本，如果list为空，会等到一个新元素加入 列表时，或者用户定义的等待时间到时，才返回，如果没有移除到元素返回null，如果超时时间为0表示永远等待，等待时间为秒。</li></ul><p><em>step3：向队列中添加数据</em></p><p>新建文件：producer-worker.js</p><pre class="md-fences md-end-block" lang=""> <div class="CodeMirror cm-s-inner CodeMirror-wrap"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 4px;"></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 30px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">/**</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> * Created by jerry on 2017/12/25.</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> */</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">var redis = require("redis");</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">var client = redis.createClient();</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">var queue = require("./queue");//引入 queue.js</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">var logsQueue = new queue.Queue("logs",client);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">var MAX = 5;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">for (var i = 0;i&lt;MAX;i++){</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  logsQueue.push("Hello world #" +i);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">console.log("Created "+MAX + " logs");//</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">client.quit();</span></pre></div></div></div></div></div><div style="position: absolute; height: 30px; width: 1px; border-bottom: 0px solid transparent; top: 312px;"></div><div class="CodeMirror-gutters" style="display: none; height: 342px;"></div></div></div></pre><p>运行后输出结果（直接在webstorm中右键运行或者在命令行输入node producer-worker）：</p><p>Created 5 logs</p><p><em>step4：从队列中提取内容</em></p><p>建立consumer-worker.js</p><pre class="md-fences md-end-block" lang="" style="break-inside: unset;"> <div class="CodeMirror cm-s-inner CodeMirror-wrap"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 4px;"></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 30px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">var redis = require("redis");</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">var client = redis.createClient();</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">var queue =require("./queue");</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">var logsQueue = new queue.Queue("logs",client);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">function logMessages() {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  logsQueue.pop(function (err,replies) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  var queueName = replies[0];</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  var message = replies[1];</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  console.log("[got message]:"+message);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  logsQueue.size(function (err,size) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  console.log(size +" logs left");</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  });</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  logMessages();</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  });</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">logMessages();</span></pre></div></div></div></div></div><div style="position: absolute; height: 30px; width: 1px; border-bottom: 0px solid transparent; top: 408px;"></div><div class="CodeMirror-gutters" style="display: none; height: 438px;"></div></div></div></pre><p><em>说明：程序采用递归调用，并一直等待，一点有内容加入队列就会取出来</em></p><h3><a name='header-n518' class='md-header-anchor md-print-anchor' href='af://n518'> </a>Hash类型</h3><h4><a name='header-n519' class='md-header-anchor md-print-anchor' href='af://n519'> </a>hash概述</h4><ul><li>在redis中，hash是String到String的映射。</li><li>在redis内部hash被处理成ziplist和hashtable</li><li>ziplist是经过内存优化的双向链表</li></ul><h4><a name='header-n530' class='md-header-anchor md-print-anchor' href='af://n530'> </a>在redis-cli中使用hash</h4><p><strong>HSET</strong></p><p>将某个域和值设置到指定key下</p><p>语法：HSET 	 【key】		【field】	【value】</p><p><strong>HMSET</strong></p><p>为key设置多个域值，用空格隔开</p><p><strong>HINCRBY</strong></p><p>将一个域的值加上一个整数</p><p><strong>HINCRBYFLOAT</strong></p><p>和hincrby类似，只是换成浮点数</p><p><em>示例</em></p><p>127.0.0.1:6379&gt; hset movie &quot;title&quot; &quot;the Greate Wall&quot;
(integer) 1
127.0.0.1:6379&gt; hmset movie &quot;year&quot; 2014 &quot;rating&quot; 8.5 &quot;watchers&quot; 10000
OK
127.0.0.1:6379&gt; hincrby movie &quot;watchers&quot; 3
(integer) 10003
127.0.0.1:6379&gt;</p><p><strong>HGET/HMGET</strong></p><p>从hash中返回一个/多个域</p><p><strong>HDEL</strong></p><p>从hash中删除一个域</p><p><strong>HGETALL</strong></p><p>返回一个数组，包含hash中所有域/值对</p><p><strong>HKEYS/HVALS</strong></p><p>从hash中分别返回域名列表和值列表</p><p><em>示例</em></p><p>127.0.0.1:6379&gt; hget movie &quot;title&quot;
&quot;the Greate Wall&quot;
127.0.0.1:6379&gt; hmget movie &quot;title&quot; &quot;watchers&quot;
1) &quot;the Greate Wall&quot;
2) &quot;10003&quot;
127.0.0.1:6379&gt; hdel movie &quot;watchers&quot;
(integer) 1
127.0.0.1:6379&gt; hgetall movie
1) &quot;title&quot;
2) &quot;the Greate Wall&quot;
3) &quot;year&quot;
4) &quot;2014&quot;
5) &quot;rating&quot;
6) &quot;8.5&quot;
127.0.0.1:6379&gt; hkeys movie
1) &quot;title&quot;
2) &quot;year&quot;
3) &quot;rating&quot;
127.0.0.1:6379&gt; hvals movie
1) &quot;the Greate Wall&quot;
2) &quot;2014&quot;
3) &quot;8.5&quot;
127.0.0.1:6379&gt;</p><h4><a name='header-n601' class='md-header-anchor md-print-anchor' href='af://n601'> </a>使用hash的投票系统</h4><p><strong>需求</strong></p><p>模拟对一篇帖子或文章投票，该帖子表现为一个连接，包含连接id，作者，标题，连接，分数（投票分）</p><p><em>step1 保存连接信息</em></p><p>新建文件hash-voting-system.js</p><pre class="md-fences md-end-block" lang=""> <div class="CodeMirror cm-s-inner CodeMirror-wrap"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 4px;"></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 30px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">function saveLink(id,author,title,link) {</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  //使用hmset建立一个保存多个域的hash</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  client.hmset("link:"+id,"author",author,"title",title,"link",link,"score",0);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre></div></div></div></div></div><div style="position: absolute; height: 30px; width: 1px; border-bottom: 0px solid transparent; top: 144px;"></div><div class="CodeMirror-gutters" style="display: none; height: 174px;"></div></div></div></pre><p><em>step2：编写upVote和downVote函数</em></p><pre class="md-fences md-end-block" lang=""> <div class="CodeMirror cm-s-inner CodeMirror-wrap"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 4px;"></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 30px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">function upVote(id) {</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  client.hincrby("link:"+id,"score",1);//将票数加1</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">function downVote(id) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  client.hincrby("link:"+id,"score",-1);//将票数减1，在hash中没有hdecryb方法，可以通过传递负值的方式实现该功能</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre></div></div></div></div></div><div style="position: absolute; height: 30px; width: 1px; border-bottom: 0px solid transparent; top: 216px;"></div><div class="CodeMirror-gutters" style="display: none; height: 246px;"></div></div></div></pre><p><em>step3 显示投票信息</em></p><pre class="md-fences md-end-block" lang=""> <div class="CodeMirror cm-s-inner CodeMirror-wrap"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 4px;"></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 30px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">function showDetails(id) {</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  client.hgetall("link:"+id,function (err,replies) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  console.log("Title:"+replies['title']);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  console.log("Author:"+replies['author']);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  console.log("Link:"+replies['link']);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  console.log("Score:"+replies['score']);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  console.log("---------------------------------------")</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  });</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre></div></div></div></div></div><div style="position: absolute; height: 30px; width: 1px; border-bottom: 0px solid transparent; top: 216px;"></div><div class="CodeMirror-gutters" style="display: none; height: 246px;"></div></div></div></pre><p><em>step4 测试代码</em></p><pre class="md-fences md-end-block" lang=""> <div class="CodeMirror cm-s-inner CodeMirror-wrap"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 4px;"></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 30px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">saveLink(111,"jerry","jerry test link abc","http://www.abc.cn/jerry");</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">upVote(111);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">upVote(111);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">saveLink(112,"petter","How to driver a car","http://www.abc.cn/driver");</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">upVote(112);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">upVote(112);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">downVote(112);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">showDetails(111);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">showDetails(112);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">client.quit();</span></pre></div></div></div></div></div><div style="position: absolute; height: 30px; width: 1px; border-bottom: 0px solid transparent; top: 288px;"></div><div class="CodeMirror-gutters" style="display: none; height: 318px;"></div></div></div></pre><p><em>step5 运行结果</em></p><pre class="md-fences md-end-block" lang=""> <div class="CodeMirror cm-s-inner CodeMirror-wrap"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 4px;"></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 30px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">Title:jerry test link abc</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">Author:jerry</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">Link:http://www.abc.cn/jerry</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">Score:2</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">---------------------------------------</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">Title:How to driver a car</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">Author:petter</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">Link:http://www.abc.cn/driver</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">Score:1</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">---------------------------------------</span></pre></div></div></div></div></div><div style="position: absolute; height: 30px; width: 1px; border-bottom: 0px solid transparent; top: 240px;"></div><div class="CodeMirror-gutters" style="display: none; height: 270px;"></div></div></div></pre><p>&nbsp;</p></div>
<script> window.setBreakPage = function(b){var node = document.querySelectorAll('[data-breakpage]'); for(var i=0;i<node.length;i++){node[i].style.pageBreakBefore = b ? 'always':'' }}; setBreakPage(false);</script><script>(function (){for(var e=document.querySelectorAll("#write figure"),t=0;t<e.length;t++){var n=e[t];n.style.zoom=Math.min(n.clientWidth/n.scrollWidth,1),n.style.overflowX="hidden",n.style.overflowy="hidden"}})();</script></body>
</html>